# KisaMore – Architecture

## Общая идея
KisaMore — система управления стеллажами в теплице на Raspberry Pi.
Каждый стеллаж имеет:
- свет (12В LED лента)
- полив (12В клапан)

Управление:
- вручную
- по расписанию

---

## Компоненты

### Backend
- Python 3.11
- FastAPI
- SQLite (`kisamore.db`)
- GPIO через gpiozero

### Frontend
- HTML + CSS + Vanilla JS
- карточки стеллажей
- модальные окна (расписание, настройки)

---

## Конфигурация оборудования

Файл: `config/kisamore.yaml`

Содержит:
- количество стеллажей
- привязку стеллаж → реле
- привязку реле → GPIO (BCM)

---

## Модель данных

### RackState
- rack_id
- light_on / water_on
- light_mode / water_mode

### RackSchedule
- rack_id
- JSON расписания (по дням недели)

---

## Планировщик

Модуль: `app/scheduler.py`

- тик каждые N секунд
- сравнивает текущее время с расписанием
- если режим `schedule` — включает/выключает реле

---

## GPIO

- Управление идёт через `GPIODriver`
- Работаем с реле (1..16)
- Реальные GPIO берутся из конфига

---

## Потенциальные расширения
- датчики уровня воды
- защита насоса
- логирование
- MQTT / Home Assistant
